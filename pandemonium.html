<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pressure Minigame</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      flex-direction: column;
      cursor: none; /* Nasconde il cursore reale */
    }
    #start-screen, #game-area {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }
    #start-screen {
      background-color: #000;
      color: #fff;
    }
    #game-area {
      display: none; /* Nascondi inizialmente il gioco */
    }
    #game-area .rect {
      width: 10%;
      aspect-ratio: 1;
      border: 2px solid red;
      position: relative;
      overflow: hidden; /* Assicurati che il rettangolo non superi il suo limite */
    }
    #cursor {
      width: 15px;
      height: 15px;
      background-color: green;
      border-radius: 50%;
      position: absolute;
      cursor: none; /* Nasconde il cursore */
    }
    #message {
      margin: 10px;
      text-align: center;
      font-size: 1.2em;
    }
    #penalty-bar-container {
      width: 80%;
      height: 20px;
      background-color: #333;
      border: 2px solid white;
      margin-top: 10px;
      position: relative;
    }
    #penalty-bar {
      height: 100%;
      background-color: red;
      width: 0%;
    }
  </style>
</head>
<body>
  <!-- Schermata di inizio -->
  <div id="start-screen">
    <h1>Benvenuto nel minigioco Pressure</h1>
    <p>Cerca di mantenere il cursore nel rettangolo per vincere!</p>
    <button id="start-btn">Inizia</button>
  </div>

  <!-- Area di gioco -->
  <div id="game-area">
    <div class="rect" id="rect">
      <div id="cursor"></div>
    </div>
    <div id="message">Mantieni il cursore nel rettangolo!</div>
    <div id="penalty-bar-container">
      <div id="penalty-bar"></div>
    </div>
  </div>

  <script>
    const startScreen = document.getElementById("start-screen");
    const gameArea = document.getElementById("game-area");
    const startBtn = document.getElementById("start-btn");

    const rect = document.getElementById("rect");
    const cursor = document.getElementById("cursor");
    const message = document.getElementById("message");
    const penaltyBar = document.getElementById("penalty-bar");

    let timerMain = 60; // Timer principale
    let penaltyTime = 0; // Timer penalità
    let isInArea = true;
    const penaltyMax = 5; // Penalità massima in secondi
    const penaltyRecovery = 0.1; // Recupero penalità per secondo
    const penaltyIncrement = 1; // Penalità aggiunta per secondo fuori area

    let isMouseDown = false; // Flag per tenere premuto il mouse o il dito
    let rectBounds, cursorX, cursorY;

    // Inizializzazione del gioco
    startBtn.addEventListener("click", () => {
      startScreen.style.display = "none";
      gameArea.style.display = "flex";
      document.body.style.cursor = "none"; // Nascondi il cursore dopo l'inizio
      startGame();
    });

    function startGame() {
      cursorX = rect.offsetWidth / 2;
      cursorY = rect.offsetHeight / 2;

      // Movimentazione casuale del cursore
      const disturbanceInterval = 50; // Aggiornamento ogni 50 ms
      setInterval(() => {
        rectBounds = rect.getBoundingClientRect();

        if (isMouseDown) {
          const mouseX = cursorX + (Math.random() - 0.5) * 40; // Muoversi in tutte le direzioni
          const mouseY = cursorY + (Math.random() - 0.5) * 40;

          // Assicurati che il cursore rimanga all'interno del rettangolo
          cursorX = Math.max(0, Math.min(rectBounds.width - 15, mouseX));
          cursorY = Math.max(0, Math.min(rectBounds.height - 15, mouseY));

          // Blocca il movimento del mouse del computer per evitare fuori dal browser
          window.addEventListener('mousemove', (e) => {
            e.preventDefault(); // Blocca il movimento del mouse del computer
          });
        }

        // Muovi il cursore
        cursor.style.left = `${cursorX}px`;
        cursor.style.top = `${cursorY}px`;
      }, disturbanceInterval);

      // Timer di gioco
      const gameInterval = setInterval(() => {
        timerMain--;

        if (timerMain <= 0) {
          clearInterval(gameInterval);
          message.textContent = isInArea ? "Hai vinto!" : "Game Over!";
          message.style.color = isInArea ? "green" : "red";
          return;
        }

        // Aggiornamento della penalità
        if (!isInArea) {
          penaltyTime += penaltyIncrement; // Aumenta la penalità
        } else {
          penaltyTime = Math.max(0, penaltyTime - penaltyRecovery); // Recupera penalità
        }

        // Controllo barra di penalità
        const penaltyPercentage = (penaltyTime / penaltyMax) * 100;
        penaltyBar.style.width = `${Math.min(100, penaltyPercentage)}%`;

        // Game Over se la penalità massima è raggiunta
        if (penaltyTime >= penaltyMax) {
          clearInterval(gameInterval);
          message.textContent = "Game Over!";
          message.style.color = "red";
        } else {
          message.textContent = `Tempo rimanente: ${timerMain} secondi`;
        }
      }, 1000);
    }

    // Gestione mouse e tocco per mantenere il cursore nel rettangolo
    document.addEventListener("mousedown", () => {
      isMouseDown = true;
    });

    document.addEventListener("mouseup", () => {
      isMouseDown = false;
    });

    document.addEventListener("touchstart", () => {
      isMouseDown = true;
    });

    document.addEventListener("touchend", () => {
      isMouseDown = false;
    });
  </script>
</body>
</html>
