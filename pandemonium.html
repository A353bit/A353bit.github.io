<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pressure Minigame</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      flex-direction: column;
    }
    #game-area {
      width: 10%; /* Rettangolo più piccolo */
      aspect-ratio: 1;
      border: 2px solid red;
      position: relative;
    }
    #cursor {
      width: 15px;
      height: 15px;
      background-color: green;
      border-radius: 50%;
      position: absolute;
    }
    #message {
      margin: 10px;
      text-align: center;
      font-size: 1.2em;
    }
    #penalty-bar-container {
      width: 80%;
      height: 20px;
      background-color: #333;
      border: 2px solid white;
      margin-top: 10px;
      position: relative;
    }
    #penalty-bar {
      height: 100%;
      background-color: red;
      width: 0%;
    }
  </style>
</head>
<body>
  <div id="game-area">
    <div id="cursor"></div>
  </div>
  <div id="message">Mantieni il cursore nel rettangolo!</div>
  <div id="penalty-bar-container">
    <div id="penalty-bar"></div>
  </div>

  <script>
    const cursor = document.getElementById("cursor");
    const gameArea = document.getElementById("game-area");
    const message = document.getElementById("message");
    const penaltyBar = document.getElementById("penalty-bar");

    let timerMain = 60; // Timer principale
    let penaltyTime = 0; // Timer penalità
    let isInArea = true;
    const penaltyMax = 5; // Penalità massima in secondi
    const penaltyRecovery = 0.1; // Recupero penalità per secondo
    const penaltyIncrement = 1; // Penalità aggiunta per secondo fuori area

    // Funzione per verificare la posizione disturbata del cursore
    function checkPosition(x, y) {
      const rect = gameArea.getBoundingClientRect();

      // Disturbo casuale
      const disturbedX = x + (Math.random() * 20 - 10);
      const disturbedY = y + (Math.random() * 20 - 10);

      // Verifica se il cursore è nell'area
      isInArea = disturbedX > 0 && disturbedX < rect.width && disturbedY > 0 && disturbedY < rect.height;

      // Sposta il cursore
      cursor.style.left = `${Math.max(0, Math.min(rect.width - 15, disturbedX))}px`;
      cursor.style.top = `${Math.max(0, Math.min(rect.height - 15, disturbedY))}px`;
    }

    // Eventi per il mouse
    gameArea.addEventListener("mousemove", (event) => {
      const rect = gameArea.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      checkPosition(x, y);
    });

    // Eventi per il tocco (mobile)
    gameArea.addEventListener("touchmove", (event) => {
      const rect = gameArea.getBoundingClientRect();
      const touch = event.touches[0];
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      checkPosition(x, y);
    });

    // Timer di gioco
    const gameInterval = setInterval(() => {
      // Aggiornamento del timer principale
      timerMain--;
      if (timerMain <= 0) {
        clearInterval(gameInterval);
        message.textContent = isInArea ? "Hai vinto!" : "Game Over!";
        message.style.color = isInArea ? "green" : "red";
        return;
      }

      // Aggiornamento della penalità
      if (!isInArea) {
        penaltyTime += penaltyIncrement; // Aumenta la penalità
      } else {
        penaltyTime = Math.max(0, penaltyTime - penaltyRecovery); // Recupera penalità
      }

      // Controlla la barra della penalità
      const penaltyPercentage = (penaltyTime / penaltyMax) * 100;
      penaltyBar.style.width = `${Math.min(100, penaltyPercentage)}%`;

      // Game Over se la penalità massima è raggiunta
      if (penaltyTime >= penaltyMax) {
        clearInterval(gameInterval);
        message.textContent = "Game Over!";
        message.style.color = "red";
      } else {
        message.textContent = `Tempo rimanente: ${timerMain} secondi`;
      }
    }, 1000);
  </script>
</body>
</html>
