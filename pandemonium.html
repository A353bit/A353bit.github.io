<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pressure Minigame</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      flex-direction: column;
    }
    #start-screen, #game-area {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }
    #start-screen {
      background-color: #000;
      color: #fff;
    }
    #game-area {
      display: none;
    }
    #game-area .rect {
      width: 200px;
      height: 200px;
      border: 2px solid red;
      position: relative;
    }
    #cursor {
      width: 15px;
      height: 15px;
      background-color: green;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    #penalty-bar-container {
      width: 80%;
      height: 20px;
      background-color: #333;
      border: 2px solid white;
      margin-top: 10px;
      position: relative;
    }
    #penalty-bar {
      height: 100%;
      background-color: red;
      width: 0%;
    }
    #message {
      margin: 10px;
      text-align: center;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <!-- Schermata di inizio -->
  <div id="start-screen">
    <h1>Pressure Minigame</h1>
    <p>Mantieni il cursore nel rettangolo!</p>
    <button id="start-btn">Inizia</button>
  </div>

  <!-- Area di gioco -->
  <div id="game-area">
    <div class="rect" id="rect">
      <div id="cursor"></div>
    </div>
    <div id="message">Mantieni il cursore nel rettangolo!</div>
    <div id="penalty-bar-container">
      <div id="penalty-bar"></div>
    </div>
  </div>

  <script>
    const startScreen = document.getElementById("start-screen");
    const gameArea = document.getElementById("game-area");
    const startBtn = document.getElementById("start-btn");

    const rect = document.getElementById("rect");
    const cursor = document.getElementById("cursor");
    const message = document.getElementById("message");
    const penaltyBar = document.getElementById("penalty-bar");

    let isMouseDown = false;
    let cursorX = 0, cursorY = 0;
    let penaltyTime = 0, mainTimer = 60;
    const penaltyMax = 5; // Penalità massima
    const penaltyIncrement = 1; // Penalità per secondo fuori
    const penaltyRecovery = 0.1; // Recupero per secondo dentro

    // Inizializzazione del gioco
    startBtn.addEventListener("click", () => {
      startScreen.style.display = "none";
      gameArea.style.display = "flex";
      document.body.requestPointerLock(); // Blocca il cursore del computer
      startGame();
    });

    function startGame() {
      cursor.style.left = "50%";
      cursor.style.top = "50%";

      // Movimento del cursore
      document.addEventListener("mousemove", handleMouseMove);

      // Timer di gioco
      const gameInterval = setInterval(() => {
        mainTimer--;

        // Controlla il tempo rimasto
        if (mainTimer <= 0) {
          clearInterval(gameInterval);
          endGame(true);
        }

        // Aggiorna la penalità
        const isInRect = checkCursorInRect();
        if (!isInRect) {
          penaltyTime += penaltyIncrement;
        } else {
          penaltyTime = Math.max(0, penaltyTime - penaltyRecovery);
        }

        // Aggiorna la barra della penalità
        const penaltyPercentage = Math.min(100, (penaltyTime / penaltyMax) * 100);
        penaltyBar.style.width = `${penaltyPercentage}%`;

        // Controlla se la penalità massima è raggiunta
        if (penaltyTime >= penaltyMax) {
          clearInterval(gameInterval);
          endGame(false);
        }

        message.textContent = `Tempo rimanente: ${mainTimer}s`;
      }, 1000);
    }

    function handleMouseMove(event) {
      if (!isMouseDown) return; // Sposta il cursore solo se il mouse è premuto

      const movementX = event.movementX || 0;
      const movementY = event.movementY || 0;

      cursorX += movementX;
      cursorY += movementY;

      cursor.style.left = `${cursorX}px`;
      cursor.style.top = `${cursorY}px`;
    }

    function checkCursorInRect() {
      const rectBounds = rect.getBoundingClientRect();
      const cursorBounds = cursor.getBoundingClientRect();

      return (
        cursorBounds.left >= rectBounds.left &&
        cursorBounds.right <= rectBounds.right &&
        cursorBounds.top >= rectBounds.top &&
        cursorBounds.bottom <= rectBounds.bottom
      );
    }

    function endGame(isVictory) {
      document.exitPointerLock(); // Rilascia il blocco del puntatore
      message.textContent = isVictory ? "Hai vinto!" : "Game Over!";
      message.style.color = isVictory ? "green" : "red";
      document.removeEventListener("mousemove", handleMouseMove);
    }

    document.addEventListener("mousedown", () => {
      isMouseDown = true;
    });

    document.addEventListener("mouseup", () => {
      isMouseDown = false;
    });

    document.addEventListener("touchstart", () => {
      isMouseDown = true;
    });

    document.addEventListener("touchend", () => {
      isMouseDown = false;
    });
  </script>
</body>
</html>
